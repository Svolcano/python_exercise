# -*- coding: utf-8 -*-import pymongoimport timeDEV_MONGO_CONFIG = {    'host': '172.18.19.219',    'port': 27017,    'db': 'crs'}PRO_MONGO_CONFIG = {    'host': '172.18.19.101',    'port': 27017,    'db': 'crs'}class Pro_MongodbConnection(object):    """    MongoDB连接类    """    def __init__(self):        self.conn = None        self.set_pro_db_conn()        self.sid_list=self.get_sid_set('2017-10-01','2018-04-11')    def set_pro_db_conn(self):        self.client = pymongo.MongoClient(PRO_MONGO_CONFIG['host'], PRO_MONGO_CONFIG['port'], connect=False)        self.conn = self.client[PRO_MONGO_CONFIG['db']]    def export_data(self,sid):        data = self.conn['call_log'].find({'sid':sid},{'_id':0})        return data        def get_sid_set(self,begindate,enddate=int(time.time())):        timeArray = time.strptime(begindate, "%Y-%m-%d")        begindate = time.mktime(timeArray)        timeArray = time.strptime(enddate, "%Y-%m-%d")        enddate = time.mktime(timeArray)        data = self.conn['sid_info'].find({"end_time":{'$gte':begindate,'$lte':enddate},'status':0},{'_id':0,'job_id':0})        return data    class Dev_MongodbConnection(object):    """    MongoDB连接类    """    def __init__(self):        self.conn = None        self.set_dev_db_conn()    def set_dev_db_conn(self):        self.client = pymongo.MongoClient(DEV_MONGO_CONFIG['host'], DEV_MONGO_CONFIG['port'], connect=False)        self.conn = self.client[DEV_MONGO_CONFIG['db']]    def insert_sid_info_data(self,data):        ret = self.conn['sid_info'].insert_one(data)        return ret    def insert_call_log(self,data):        ret = self.conn['call_log'].insert_one(data)          return retif __name__ == '__main__':    pro_conn = Pro_MongodbConnection()    dev_conn = Dev_MongodbConnection()    for  sid in pro_conn.sid_list:        print sid        dev_conn.insert_sid_info_data(sid)        datas=pro_conn.export_data(sid['sid'])        for data in  datas:            dev_conn.insert_call_log(data)                                                            